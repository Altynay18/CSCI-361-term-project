<!DOCTYPE html>
<html xmlns:th="http://www.w3.org/1999/xhtml">
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,600;1,400&family=Junge&display=swap" rel="stylesheet">

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
<style>
table {
  border: 1px solid black;
}
input[type=text], select {
  width: 100%;
  padding: 12px 20px;
  margin: 8px 0;
  display: inline-block;
  border: 1px solid #ccc;
  border-radius: 4px;
  box-sizing: border-box;
}

input[type=submit] {
  width: 100%;
  background-color: #4CAF50;
  color: white;
  padding: 14px 20px;
  margin: 8px 0;
  border: none;
  border-radius: 4px;
  cursor: pointer;
}

input[type=submit]:hover {
  background-color: #45a049;
}

div {
  border-radius: 5px;
  background-color: #f2f2f2;
  padding: 20px;
}
</style>
</head>

<body style="background-color: white">
<a class="btn btn-outline-primary" th:href="@{/}">Main page</a>

<div style="background-color: white">

<h2 style="font-family: 'Cormorant Garamond', serif;" align="center">Search Available rooms</h2>
<h3 style="font-family: 'Cormorant Garamond', serif;" align="center">Click on the button to open the dropdown menu, <br> use the input field to search for a specific available room.</h3>

  <form class="w3-container" style="margin-top: 40px; margin-left: 500px; margin-right: 500px; background-color: white">
      <label style="font-family: 'Cormorant Garamond', serif;" for="browser">Country:</label><br>
      <input  class = "w3-input w3-border" list="country" id="myCountry" onchange="getCityList(),getRoomtypeList()"><br>
      <datalist id="country">
      </datalist>

      <label style="font-family: 'Cormorant Garamond', serif;" for="browser">City:</label><br>
      <input  class = "w3-input w3-border" list="city" id="myCity" onchange="getRoomtypeList()"><br>
      <datalist id="city">
      </datalist>

      <label style="font-family: 'Cormorant Garamond', serif;" for="browser">Room Type:</label>
      <input  class = "w3-input w3-border" list="roomtype" id="myRoomtype">
      <datalist id="roomtype">
      </datalist>
<br>
      <label style="font-family: 'Cormorant Garamond', serif;" for="browser">Capacity:</label>
      <input  class = "w3-input w3-border" list="capacity" id="myCapacity">
      <datalist id="capacity">
</datalist>
      <br>
      <label style="font-family: 'Cormorant Garamond', serif;" for="browser">From:</label>
     <input style="font-family: 'Cormorant Garamond', serif;"  class = "w3-input" type="date" id="from-date">

    <label  style="font-family: 'Cormorant Garamond', serif;" for="browser">To:</label>
    <input style="font-family: 'Cormorant Garamond', serif;" class = "w3-input" type="date" id="to-date">

    <input style="font-family: 'Cormorant Garamond', serif;" class = "w3-input" type="submit" value="Search" id="search" onclick="availableRooms()">
    </form>
    </div>
<br>
<br>
<label style="font-family: 'Cormorant Garamond', serif;" for="browser">Available rooms:</label>
<br>
<table style="width:70%" id="my-list"></table>

<script>

function updateList(items, tag) {
    $(tag).html("");
//    $(tag).append("<option value=\"Default\">");
    items.forEach(function (e) {
        $(tag).append("<option value=\""+e+"\">");
    });
}

function availableRooms() {
	var myUrl = "search/available?";
	var country = document.getElementById("myCountry").value;
	var city = document.getElementById("myCity").value;
	var roomtype = document.getElementById("myRoomtype").value;
	var capacity = document.getElementById("myCapacity").value;
	var from = document.getElementById("from-date").value;
	var to = document.getElementById("to-date").value;
	
	if (country != "") {
		myUrl = myUrl+"country="+country+"&";
	}
	if (city != "") {
		myUrl = myUrl+"city="+city+"&";
	}
	if (roomtype != "") {
		myUrl = myUrl+"roomtype="+roomtype+"&";
	}
	if (capacity != "") {
		myUrl = myUrl+"capacity="+capacity+"&";
	}
	if (from != "") {
		myUrl = myUrl+"from="+from+"&";
	if (to != "")
		myUrl = myUrl+"to="+to+"&";
	}

	$.ajax({
        url : myUrl,
        dataType : 'json',
        success : function(r) {
        	$("#my-list").html("");
        	if(!$.trim(r)){
        		$("#my-list").append("Sorry, No available rooms found. Try to search for other criterias.");
        	
        	} else {
        	$("#my-list").append("<tr><th>Country</th><th>City</th><th>Room Type</th><th>Capacity</th><th>Price</th></tr>");

        	r.forEach(function (e) {
        		$("#my-list").append("<tr><td>"+e.roomType.hotel.country+"</td><td>"+e.roomType.hotel.city+
        				"</td><td>"+e.room_id.room_type_id.room_type_name+"</td><td>"+e.roomType.capacity+"</td><td>"+e.roomType.price+"</td><td><a href=\"search\\bookingform\"><button type=\"button\">"+
        				"Book"+"</button></a></td></tr>"); 
/*         		$("#my-list").append("<tr><td>"+e.hotel.country+"</td><td>"+e.hotel.city+
        				"</td><td>"+e.roomNumber+"</td><td>"+e.capacity+"</td><td><a href=\"search\\hotel\\"+e.hotel.id+"\"><button type=\"button\">"+
        				"Book"+"</button></a></td></tr>");  <--with id */
        	
          }); 

        }}
    });

}

function getCountryList() {
    $.ajax({
        url : 'search/countries',
        dataType : 'json',
        success : function(r) {
            updateList(r, "#country");
        }
    });
}

function bookHotel(index) {

	$.ajax({
		url : 'search/hotel/',
		dataType : 'json',
		success : function(r) {
		//	updateList(r);
		}
	});
} 


function getCityList() {
	var country = document.getElementById("myCountry").value;
	var myUrl;
	if (country == "")
		myUrl = 'search/cities';
	else
		myUrl = 'search/cities?country='+country;
    $.ajax({
        url : myUrl,
        dataType : 'json',
        success : function(r) {
            updateList(r, "#city");
        }
    });
}

function getRoomtypeList() {
	var country = document.getElementById("myCountry").value;
	var city = document.getElementById("myCity").value;
	var myUrl="search/roomtypes?";
	
	if (country != "") {
		myUrl = myUrl+"country="+country+"&";
	}
	if (city != "") {
		myUrl = myUrl+"city="+city;
	}
	
    $.ajax({
        url : myUrl,
        dataType : 'json',
        success : function(r) {
            updateList(r, "#roomtype");
        }
    });
}


$(document).ready(function () {
	getCountryList();
	getCityList();
	getRoomtypeList();
	availableRooms();


});
</script>

</body>
</html>
